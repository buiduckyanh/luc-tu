const images = [
  {
    src: "00a.jpg",
    title: "mute.mp3",
    caption: "mute.mp3",
    details: "Details 00a",
  },
  {
    src: "00b.jpg",
    title: "mute.mp3",
    caption: "mute.mp3",
    details: "Details 00b",
  },
  {
    src: "00c.jpg",
    title: "mute.mp3",
    caption: "mute.mp3",
    details: "Details 00c",
  },
  {
    src: "00d.jpg",
    title: "mute.mp3",
    caption: "mute.mp3",
    details: "Details 00d",
  },
  {
    src: "01.jpg",
    title: "01.mp3",
    caption: "01-cap.mp3",
    details: "Details 1",
  },
  {
    src: "02.jpg",
    title: "02.mp3",
    caption: "02-cap.mp3",
    details: "Details 2",
  },
  {
    src: "03.jpg",
    title: "03.mp3",
    caption: "03-cap.mp3",
    details: "Details 3",
  },
  {
    src: "04.jpg",
    title: "04.mp3",
    caption: "04-cap.mp3",
    details: "Details 4",
  },
  {
    src: "05.jpg",
    title: "05.mp3",
    caption: "mute.mp3",
    details: "Details 5",
  },
  {
    src: "06a.jpg",
    title: "06a.mp3",
    caption: "06a-cap.mp3",
    details: "Details 6a",
  },
  {
    src: "06b.jpg",
    title: "06b.mp3",
    caption: "06b-cap.mp3",
    details: "Details 6b",
  },
  {
    src: "06c.jpg",
    title: "06c.mp3",
    caption: "06c-cap.mp3",
    details: "Details 6c",
  },
  {
    src: "06d.jpg",
    title: "06d.mp3",
    caption: "06d-cap.mp3",
    details: "Details 6d",
  },
  {
    src: "06e.jpg",
    title: "06e.mp3",
    caption: "06e-cap.mp3",
    details: "Details 6e",
  },
  {
    src: "07a.jpg",
    title: "07a.mp3",
    caption: "07a-cap.mp3",
    details: "Details 7a",
  },
  {
    src: "07b.jpg",
    title: "07b.mp3",
    caption: "07b-cap.mp3",
    details: "Details 7b",
  },
  {
    src: "07c.jpg",
    title: "07c.mp3",
    caption: "07c-cap.mp3",
    details: "Details 7c",
  },
  {
    src: "08.jpg",
    title: "08.mp3",
    caption: "08-cap.mp3",
    details: "Details 8",
  },
  {
    src: "09.jpg",
    title: "09.mp3",
    caption: "09-cap.mp3",
    details: "Details 9",
  },
  {
    src: "10.jpg",
    title: "10.mp3",
    caption: "10-cap.mp3",
    details: "Details 10",
  },
  {
    src: "11.jpg",
    title: "11.mp3",
    caption: "11-cap.mp3",
    details: "Details 11",
  },
  {
    src: "12.jpg",
    title: "12.mp3",
    caption: "12-cap.mp3",
    details: "Details 12",
  },
  {
    src: "13.jpg",
    title: "13.mp3",
    caption: "13-cap.mp3",
    details: "Details 13",
  },
  {
    src: "14.jpg",
    title: "14.mp3",
    caption: "14-cap.mp3",
    details: "Details 14",
  },
  {
    src: "15.jpg",
    title: "15.mp3",
    caption: "15-cap.mp3",
    details: "Details 15",
  },
  {
    src: "16.jpg",
    title: "16.mp3",
    caption: "16-cap.mp3",
    details: "Details 16",
  },
  {
    src: "17.jpg",
    title: "17.mp3",
    caption: "17-cap.mp3",
    details: "Details 17",
  },
  {
    src: "18.jpg",
    title: "18.mp3",
    caption: "18-cap.mp3",
    details: "Details 18",
  },
  {
    src: "19.jpg",
    title: "19.mp3",
    caption: "19-cap.mp3",
    details: "Details 19",
  },
  {
    src: "20.jpg",
    title: "20.mp3",
    caption: "20-cap.mp3",
    details: "Details 20",
  },
  {
    src: "21.jpg",
    title: "21.mp3",
    caption: "21-cap.mp3",
    details: "Details 21",
  },
  {
    src: "22.jpg",
    title: "22.mp3",
    caption: "22-cap.mp3",
    details: "Details 22",
  },
  {
    src: "23.jpg",
    title: "23.mp3",
    caption: "23-cap.mp3",
    details: "Details 23",
  },
  {
    src: "24.jpg",
    title: "24.mp3",
    caption: "24-cap.mp3",
    details: "Details 24",
  },
  {
    src: "25.jpg",
    title: "25.mp3",
    caption: "25-cap.mp3",
    details: "Details 25",
  },
  {
    src: "26.jpg",
    title: "26.mp3",
    caption: "26-cap.mp3",
    details: "Details 26",
  },
  {
    src: "27.jpg",
    title: "27.mp3",
    caption: "27-cap.mp3",
    details: "Details 27",
  },
  {
    src: "28a.jpg",
    title: "28a.mp3",
    caption: "28a-cap.mp3",
    details: "Details 28a",
  },
  {
    src: "28b.jpg",
    title: "28b.mp3",
    caption: "28b-cap.mp3",
    details: "Details 28b",
  },
  {
    src: "29a1.jpg",
    title: "29a.mp3",
    caption: "29a-cap.mp3",
    details: "Details 29a1",
  },
  {
    src: "29a2.jpg",
    title: "29a2.mp3",
    caption: "29a2-cap.mp3",
    details: "Details 29a2",
  },
  {
    src: "29b.jpg",
    title: "29b.mp3",
    caption: "29b-cap.mp3",
    details: "Details 29b",
  },
  {
    src: "30a.jpg",
    title: "30a.mp3",
    caption: "30a-cap.mp3",
    details: "Details 30a",
  },
  {
    src: "30b.jpg",
    title: "30b.mp3",
    caption: "30b-cap.mp3",
    details: "Details 30b",
  },
  {
    src: "31.jpg",
    title: "31.mp3",
    caption: "31-cap.mp3",
    details: "Details 31",
  },
  {
    src: "32.jpg",
    title: "32.mp3",
    caption: "32-cap.mp3",
    details: "Details 32",
  },
  {
    src: "33.jpg",
    title: "33.mp3",
    caption: "33-cap.mp3",
    details: "Details 33",
  },
  {
    src: "00a.jpg",
    title: "00a.mp3",
    caption: "00a.mp3",
    details: "Details 00a",
  },
];

document.addEventListener("DOMContentLoaded", function () {
  let currentIndex = 0;
  let currentTitleAudio = null;
  let currentCaptionAudio = null;
  let captionRepeatTimeout = null;

  // Hàm để thay đổi giá trị thời gian ngừng
  function changeDelay(elementId, change) {
    let element = document.getElementById(elementId);
    let currentValue = parseFloat(element.textContent);
    let newValue = currentValue + change;
    if (newValue < 0.5) newValue = 0.5; // Giới hạn giá trị nhỏ nhất là 0.5 giây
    element.textContent = newValue.toFixed(1); // Cập nhật hiển thị với 1 chữ số thập phân
  }
  function changeTele() {}

  function updateImage(index) {
    // Dừng âm thanh hiện tại nếu có
    if (currentCaptionAudio) {
      currentCaptionAudio.pause();
      currentCaptionAudio.currentTime = 0; // Quay lại đầu file âm thanh
    }
    // Load du lieu cua tam hinh hien tai
    const image = images[index];
    document.getElementById("current-image").src = "/res/images/" + image.src;
    playAudio("/res/audios/" + image.title, "/res/audios/" + image.caption);
  }

  function playAudio(titleAudioSrc, captionAudioSrc) {
    // Dừng và đặt lại các âm thanh hiện tại nếu chúng đang phát
    if (currentTitleAudio) {
      currentTitleAudio.pause();
      currentTitleAudio.currentTime = 0;
    }

    if (currentCaptionAudio) {
      currentCaptionAudio.pause();
      currentCaptionAudio.currentTime = 0;
    }

    // Hủy bất kỳ lệnh setTimeout nào đang tồn tại
    if (captionRepeatTimeout) {
      console.log("clear caption Repeat Timeout");
      clearTimeout(captionRepeatTimeout);
    }

    let titleAudioIsNull = false;
    let captionAudioIsNull = false;

    currentTitleAudio = new Audio(titleAudioSrc);
    currentCaptionAudio = new Audio(captionAudioSrc);

    currentTitleAudio.onerror = (e) => {
      titleAudioIsNull = true;
      console.error("Failed to load title audio: ", titleAudioSrc, e);
      currentTitleAudio = new Audio("/res/audios/mute.mp3");
    };
    currentCaptionAudio.onerror = (e) => {
      captionAudioIsNull = true;
      console.error("Failed to load caption audio: ", captionAudioSrc, e);
      currentCaptionAudio = new Audio("/res/audios/mute.mp3");
    };

    let delayAfterTitle = 3 * 1000;
    let delayBetweenCaptions = 0.5 * 1000;

    if (currentIndex > 0) {
      if (!titleAudioIsNull) currentTitleAudio.play();
      if (!captionAudioIsNull)
        currentTitleAudio.onended = () => {
          setTimeout(() => {
            playCaptionInLoop(delayBetweenCaptions);
          }, delayAfterTitle);
        };
    }
  }

  function playCaptionInLoop(delayBetweenCaptions) {
    currentCaptionAudio.play();
    currentCaptionAudio.onended = () => {
      captionRepeatTimeout = setTimeout(() => {
        currentCaptionAudio.currentTime = 0;
        currentCaptionAudio.play();
      }, delayBetweenCaptions);
    };
  }

  // Các hàm playAudio và playCaptionInLoop sẽ lấy giá trị từ các span thay vì input

  document.getElementById("prev-button").addEventListener("click", function () {
    if (currentIndex > 0) {
      currentIndex--;
      updateImage(currentIndex);
    }
  });

  document.getElementById("next-button").addEventListener("click", function () {
    if (currentIndex < images.length - 1) {
      currentIndex++;
      updateImage(currentIndex);
    }
  });

  document
    .getElementById("image-container")
    .addEventListener("click", function () {
      if (currentIndex < images.length - 1) {
        currentIndex++;
        updateImage(currentIndex);
      }
    });

  document
    .getElementById("play-pause-button")
    .addEventListener("click", function () {
      if (currentCaptionAudio && currentCaptionAudio.paused) {
        currentCaptionAudio.play();
      } else if (currentCaptionAudio && !currentCaptionAudio.paused) {
        currentCaptionAudio.pause();
        currentCaptionAudio.currentTime = 0;
        if (captionRepeatTimeout) {
          console.log("clear caption Repeat Timeout");
          clearTimeout(captionRepeatTimeout);
        }
      }
    });

  updateImage(0);
});
